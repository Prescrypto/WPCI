{% extends "pdflayout.html" %}
{% block content %}

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
    <script src="https://mozilla.github.io/pdf.js/build/pdf.js"></script>
 <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/uikit/3.0.0-rc.5/css/uikit.min.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/uikit/3.0.0-rc.5/js/uikit.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/uikit/3.0.0-rc.5/js/uikit-icons.min.js"></script>
    <div class="row">
      {% if error %}
         <form class="message-form" method="GET">
          <center class="message" >
            <img style="width: 200px;margin-left: 40px;margin-bottom:20px;" src="/static/images/error.svg" alt="">
            <h3>
              <strong> {{ error }} </strong>
            </h3>

          <button id="backbutton" value="backbutton" name="backbutton" type="submit" class="btn btn-info btn-lg" style="padding:10px;">Go back</button></center>
        </form>
      {% elif pdffile %}
          <div class="leftcolumn col-lg-3 col-md-12" style="margin-bottom:-10px;padding-bottom:10px;">
              <!--Jumbo box organization name-->
            <div class="jumbo">
              <h3><b> {{ org_name }}</b> requires you to sign this before you can continue.</h3>
             <h4>Please read carefully and sign to continue.</h4>
            </div>

                 <!-- This is the modal -->
        <div id="modal-sign" uk-modal>
            <div class="uk-modal-dialog uk-modal-body uk-margin-auto-vertical txt-center uk-position-bottom" >
                <h2 class="uk-modal-title">Almost done! <b>We will send the document to your email.</b> </h2>
               <form class="nda-form" id="nda-form" method="POST">

                <div class="form-group">
                  <label>Give us your full name:</label>
                  <input type="text" class="form-control" id="signer_name" name="signer_name" placeholder="Enter name" required>
                </div>
                <div class="form-group">
                    <label>Give us your best email address: </label>
                    <label style="font-size: 11px">(we won't save it or use it for anything else, we promise.)</label>
                    <input type="email" class="form-control" id="signer_email" name="signer_email" aria-describedby="emailHelp" placeholder="Enter email" required>

                </div>
                <input type="hidden" id="nda_file" name="nda_file" value="">

                <div class="uk-text-center">
                    <p id="spinner"></p>
                    <button  id="signbtn" name="signbtn" type="submit" class="btn btn-info btn-lg" onClick="click_button()" >Sign!</button>
                </div>
                   </form>

            </div>
        </div>


          </div>
        <!--Closing Form-->
        <div class="col-lg-9 col-md-12" style="margin-bottom:-10px;padding-bottom: 10px;">
           <!--Pdf Container-->
            <div id="pdf_container" style="height: 800px;overflow: scroll;">
              <div id="dynamic_container" >
              </div>
                <div style="display:flex;align-items:bottom;padding-left:35%">
                    <input  onclick="checkChanged()" id="mycheck" name="mycheck" type="checkbox" style="transform: scale(2);margin-top: 4px;">
                  <label for="mycheck" style="padding-left:20px;"><h4>I agree to the above terms in this NDA</h4></label>

                 </div>

            </div>
           <!-- closing Pdf Container-->



      <script type="text/javascript">
        var winheight= $( window ).height() - 60;
        $('#pdf_container').attr('style','height:'+ winheight +'px;overflow: scroll;');
        var pdfData = atob('{{ pdffile }}');
        $('#nda_file').val('{{ pdffile }}');
        // Get div#container and cache it for later use
        var wholecontainer = document.getElementById("pdf_container");
        var container = document.getElementById("dynamic_container");

         function get_back(){
         window.location.reload();
       }

        var pdfjsLib = window['pdfjs-dist/build/pdf'];

        // The workerSrc property shall be specified.
        pdfjsLib.GlobalWorkerOptions.workerSrc = '//mozilla.github.io/pdf.js/build/pdf.worker.js';

         var loadingTask = pdfjsLib.getDocument({data: pdfData});
        loadingTask.promise.then(function(pdf) {

            // Loop from 1 to total_number_of_pages in PDF document
            for (var i = 1; i <= pdf.numPages; i++) {

                // Get desired page
                pdf.getPage(i).then(function(page) {

                  var scale = 2.5;
                  var viewport = page.getViewport(scale);
                  var div = document.createElement("div");

                  // Set id attribute with page-#{pdf_page_number} format
                  div.setAttribute("id", "page-" + (page.pageIndex + 1));

                  // This will keep positions of child elements as per our needs
                  div.setAttribute("style", "position: relative");

                  // Append div within div#container
                  container.appendChild(div);

                  // Create a new Canvas element
                  var canvas = document.createElement("canvas");

                  // Append Canvas within div#page-#{pdf_page_number}
                  div.appendChild(canvas);

                  var context = canvas.getContext('2d');
                  canvas.height = viewport.height;
                  canvas.width = viewport.width;

                  var renderContext = {
                    canvasContext: context,
                    viewport: viewport
                  };

                  // Render PDF page
                  page.render(renderContext);
                });
            }




        }, function (reason) {
          // PDF loading error
          console.error(reason);
        });

        function click_button() {
            document.getElementById("signbtn").hidden = true;
            $('#spinner').html('<p id="spinner"><div style="color:#000;margin-left:10px;margin-right:10px;" uk-spinner="ratio: 2"></div></p?');
        }

        $('#modal-sign').on('hide.uk.modal', function(){
         document.getElementById("signbtn").hidden = false;
          $('#spinner').html('<p id="spinner"></p>');
        });

        function checkChanged() {
              // Get the checkbox
              var checkBox = document.getElementById("mycheck");
                // If the checkbox is checked, show the sign modal
              if (checkBox.checked == true){
                UIkit.modal($('#modal-sign')).show();
              } else {
                UIkit.modal($('#modal-sign')).hide();
              }



         }




      </script>

    {% elif message %}

      <form class="message-form" method="POST">
        <div><img style="width:100px;margin-bottom:20px;" src="/static/images/send.svg" alt=""></div> 
        <div class="message"><strong> {{ message }} </strong></div>
      </form>

    {% endif %}
    </div>


{% endblock %}
